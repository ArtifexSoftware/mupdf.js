<!DOCTYPE html>
<html>
	<head>
		<title>MuPDF.js Simple Viewer</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="shortcut icon" href="mupdf-icon.png">
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>

	<body>

		<div id="grid-menubar">
			<div class="menu">
				<div class="menu-button">File</div>
				<div class="menu-popup">
					<div onclick="document.getElementById('open-file-input').click()">Open File...</div>
				</div>
			</div>
			<div class="menu">
				<div class="menu-button">Edit</div>
				<div class="menu-popup">
					<div onclick="documentViewer.showSearchBox()">Search...</div>
				</div>
			</div>
			<div class="menu">
				<div class="menu-button">View</div>
				<div class="menu-popup">
					<div onclick="documentViewer.toggleFullscreen()">Fullscreen</div>
					<div onclick="documentViewer.toggleOutline()">Outline</div>
					<hr>
					<div onclick="documentViewer?.setZoom(50)">50%</div>
					<div onclick="documentViewer?.setZoom(75)">75% (72 dpi)</div>
					<div onclick="documentViewer?.setZoom(100)">100% (96 dpi)</div>
					<div onclick="documentViewer?.setZoom(125)">125%</div>
					<div onclick="documentViewer?.setZoom(150)">150%</div>
					<div onclick="documentViewer?.setZoom(200)">200%</div>
				</div>
			</div>
		</div>

		<div id="grid-sidebar"><ul id="outline"></ul></div>

		<div id="grid-main" class="sidebarHidden">
			<div id="pages">
			</div>
			<div id="placeholder">
				<div>
					Loading WASM, please wait...
					<!-- TODO - improve placeholder message -->
				</div>
			</div>
		</div>

		<div id="search-dialog" class="dialog" style="display:none"></div>

		<input type="file" id="open-file-input" style="display:none"
			accept=".pdf,.xps,application/pdf"
			onchange="documentViewer.openFile(event.target.files[0])" />

	</body>

	<script src="mupdf-view.js"></script>
	<script src="mupdf-view-page.js"></script>
	<script>
		"use strict";

		let params = new URLSearchParams(window.location.search)

		let documentViewer = new MupdfDocumentViewer(mupdfView)

		mupdfView.ready
			.then(function () {
				if (params.has("file")) {
					documentViewer.openURL(params.get("file"), params.get("progressive") | 0, params.get("prefetch") | 0)
				}
				else {
					documentViewer.openEmpty()
				}
			})
			.catch(function (error) {
				documentViewer.showDocumentError("Load", error)
			});

		window.addEventListener("keydown", function (event) {
			if (event.key === "Escape") {
				documentViewer.hideSearchBox()
			}

			if (event.ctrlKey || event.metaKey) {
				switch (event.keyCode) {
				// '=' / '+' on various keyboards
				case 61:
				case 107:
				case 187:
				case 171:
					documentViewer.zoomIn()
					event.preventDefault()
					break
				// '-'
				case 173:
				case 109:
				case 189:
					documentViewer.zoomOut()
					event.preventDefault()
					break
				// '0'
				case 48:
				case 96:
					documentViewer.setZoom(100)
					break
				case 70: // 'F':
					event.preventDefault()
					documentViewer.showSearchBox()
					break
				case 71: // 'G':
					event.preventDefault()
					documentViewer.showSearchBox()
					runSearch(event.shiftKey ? -1 : 1)
					break
				}
			}
		});

	</script>
</html>
